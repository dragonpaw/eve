{% extends "base.html" %}
{% load trade %}
{% load markup %}

{% block content %}
<!-- pos: {{ pos|pprint }} --> 
<h4>{{ pos.moon }}</h4>
<p>{{ pos.note }}</p>
	<table class="pos">
	<tr><th>Owning corporation</th><td>{{ pos.corporation }}</td></tr>
	<tr><th>Depot</th><td>{{ pos.depot }}</td></tr>
	<tr><th>Online time</th><td>{{ pos.online_time }}</td></tr>
	<tr><th>Sov level</th><td>{{ pos.sov_level }}</td></tr>
	<tr><th>State</th>
	{% if pos.is_online %}<td class="online">{% else %}<td class="offline">{% endif %}
	{{ pos.state_name }}</td></tr>
	<tr><th>State time</th><td>{{ pos.state_time }}</td></tr>
	<tr><th>Cached until</th><td>{{ pos.cached_until }}</td></tr>
	<tr><th>CPU utilization</th><td>{{ pos.cpu_percent }} % (Estimated)</td></tr>
	<tr><th>Power utilization</th><td>{{ pos.power_percent }} % (Estimated)</td></tr>
	</table>
	
	<h4>Location</h4>
	<ul class="links">
	
	<li class="pos"><a href="{{ pos.solarsystem.get_absolute_url }}">
	<img src="{{ pos.solarsystem.icon32 }}">
	<span class="name">{{ pos.solarsystem }}</span><br>
	<span class="note">Solar System</span></a></li>
	
	<li class="pos"><a href="{{ pos.constellation.get_absolute_url }}">
	<img src="{{ pos.constellation.icon32 }}">
	<span class="name">{{ pos.constellation }}</span><br>
	<span class="note">Constellation</span></a></li>
	
	<li class="pos"><a href="{{ pos.region.get_absolute_url }}">
	<img src="{{ pos.region.icon32 }}">
	<span class="name">{{ pos.region }}</span><br>
	<span class="note">Region</span></a></li>
	
	</ul>
	
	<h4>Type</h4>
	<ul class="links">
	<li><a href="{{ pos.tower.get_absolute_url }}"><img src="{{ pos.tower.icon32 }}">
	<span class="name">{{ pos.tower }}</span></a></li>
	</ul>

<h4>Fuel Loaded</h4>
  {% if pos.cache_remaining %}
<p>Data here will be automatically refreshed in another 
{{ pos.cache_remaining|time }}. You may manually update it below if you are
impatient. :)</p>
{% else %}
  <p>Data here has expired from the cache and will be refreshed shortly.</p>
  {% endif %}
  <table class="pos-fuel">
    <tr>
    	<th>Fuel</th>
    	<th class="number">Qty</th>
    	<th class="number">Burn</th>
    	<th class="number">Time</th>
    	<th class="number">Need</th>
    </tr>
	{% for fuel in pos.fuel.all %}
	{% spaceless %}<tr>
	<th><a href="{{ fuel.type.get_absolute_url }}">
	  <img src="{{ fuel.type.icon16 }}"> {{ fuel.type }}</a></th>
	  <td>{{ fuel.quantity|comma }}</td>
	  <td>{{ fuel.consumption|comma }}</td>
	  {% expr fuel.time_remaining as remaining %}
	  {% expr remaining.days as days_remaining %}
	  <td class="remaining remaining-{{days_remaining}}">{{ remaining|time }}</td>
	  {% expr fuel.need(days=days) as need %}
	  <td>{{ need|comma }}</td>
	</tr>
	{% endspaceless %}{% endfor %}
  <tr><th class="runtime" colspan=3>Remaining runtime</th>
  <td class="runtime remaining">{{ pos.time_remaining|time }}</td></tr>
  </table>
  <ul class="links">
  <li><a href="{{ refuel_nav.get_absolute_url }}">
	<img src="{{ refuel_nav.icon32 }}">
	<span class="link">{{ refuel_nav.name }}</span><br>
	<span class="note">{{ refuel_nav.note }}</span></a></li>
  </ul>
  <p>'Need' is defined as the additional quantity needed for a {{ days }}-day runtime.</p> 
  
  {% ifequal pos.sov_level 'Constellation' %}
  <p class="warning">NOTE: This tower is anchored in a system where your
alliance holds constellation sovereignty. There is a known bug where the
manage screen for a tower will not include the constellation discount in
the display, even though it does actually include the discount in
consumption rates. As such, the numbers in-game will appear higher than
what is listed here. However, these are the correct numbers.</p>
  {% endifequal %}
	
	<H4>Settings</H4>
	<table class="pos">
	<tr><th>Corporation use</th>
		{% if pos.corporation_use %}<td class="enabled">Enabled{% else %}<td class="disabled">Disabled{% endif %}</td></tr>
	<tr><th>Alliance use</th>
		{% if pos.alliance_use %}<td class="enabled">Enabled{% else %}<td class="disabled">Disabled{% endif %}</td></tr>
	<tr><th>Claiming Sovereignty</th>
		{% if pos.claim %}<td class="enabled">Enabled{% else %}<td class="disabled">Disabled{% endif %}</td></tr>
	<tr><th>Attack standing below</th>
		{% if pos.attack_standing_value %}<td class="enabled">{{ pos.attack_standing_value }}{% else %}<td class="disabled">Disabled{% endif %}</td></tr>
	<tr><th>Attack sec status below</th>
		{% if pos.attack_secstatus_value %}<td class="enabled">{{ pos.attack_secstatus_value }}{% else %}<td class="disabled">Disabled{% endif %}</td></tr>
	<tr><th>Attack at war</th>
		{% if pos.attack_atwar %}<td class="enabled">Enabled{% else %}<td class="disabled">Disabled{% endif %}</td></tr>
	<tr><th>Attack on aggression</th>
		{% if pos.attack_aggression %}<td class="enabled">Enabled{% else %}<td class="disabled">Disabled{% endif %}</td></tr>
	<tr><th>Deployment flag</th><td>{{ pos.deploy_flags }}</td></tr>
	<tr><th>Usage flag</th><td>{{ pos.usage_flags }}</td></tr>
	</table>  
 {% endblock %}